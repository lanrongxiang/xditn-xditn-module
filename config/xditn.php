<?php

// +----------------------------------------------------------------------
// | XditnModule
// +----------------------------------------------------------------------
// | Copyright (c) 2017~2021 All rights reserved.
// +----------------------------------------------------------------------
// | Licensed ( https://github.com/JaguarJack/xditn-module/blob/master/LICENSE.md )
// +----------------------------------------------------------------------
// | Author: JaguarJack [ njphper@gmail.com ]
// +----------------------------------------------------------------------

return [
    /*
    |--------------------------------------------------------------------------
    | xditn-module 超级管理员
    |--------------------------------------------------------------------------
    |
    | 可以设置超级管理的用户 ID
    | 支持数组
    |
    |--------------------------------------------------------------------------
    */
    'super_admin' => 1,

    /*
    |--------------------------------------------------------------------------
    | xditn-module 请求允许
    |--------------------------------------------------------------------------
    |
    | 默认允许 GET 请求通过 RBAC 权限
    |
    |--------------------------------------------------------------------------
    */
    'request_allowed' => true,

    /*
    |--------------------------------------------------------------------------
    | xditn-module 模块设置
    |--------------------------------------------------------------------------
    |
    | 设置模块根目录
    | 设置模块的根命名空间
    | 设置模块默认生成的文件夹
    |
    |--------------------------------------------------------------------------
    */
    'module' => [
        'root' => 'modules',

        'namespace' => 'Modules',

        /**
         * 默认启动的模块.
         */
        'default' => ['develop', 'user', 'common'],

        'default_dirs' => [
            'Http'.DIRECTORY_SEPARATOR,

            'Http'.DIRECTORY_SEPARATOR.'Requests'.DIRECTORY_SEPARATOR,

            'Http'.DIRECTORY_SEPARATOR.'Controllers'.DIRECTORY_SEPARATOR,

            'Models'.DIRECTORY_SEPARATOR,
        ],

        // 模块存储驱动
        // 默认使用文件驱动
        'driver' => [
            // currently, xditn module support file and database
            // the default is driver
            'default' => 'file',

            // use database driver
            'table_name' => 'admin_modules',
        ],

        /**
         * 模块路由集合.
         */
        'routes' => [],

        /**
         * 模块是否自动加载.
         *
         * 如果设置成 true，模块会自动全部加载
         */
        'autoload' => env('XDITN_MODULE_AUTOLOAD', true),
    ],

    /*
    |--------------------------------------------------------------------------
    | xditn-module 响应
    |--------------------------------------------------------------------------
    */
    'response' => [
        // JSON 响应, 保证响应数据都是 json
        'always_json' => \XditnModule\Middleware\JsonResponseMiddleware::class,

        // 响应监听者
        // 监听[RequestHandled]事件
        'request_handled_listener' => \XditnModule\Listeners\RequestHandledListener::class,
    ],

    /*
   |--------------------------------------------------------------------------
   | 数据库 SQL 日志
   |--------------------------------------------------------------------------
   */
    'listen_db_log' => env('APP_DEBUG', true),

    /*
   |--------------------------------------------------------------------------
   | DB 日志通道
   |
   | 需要在 logging 配置对应的日志记录通道，默认使用 query
   |--------------------------------------------------------------------------
   */
    'query_log_channel' => env('QUERY_LOG_CHANNEL', 'query'),

    /*
   |--------------------------------------------------------------------------
   | 管理员授权认证模型
   |--------------------------------------------------------------------------
   */
    'auth_model' => \Modules\User\Models\User::class,

    /*
   |--------------------------------------------------------------------------
   | 管理员授权 Guard
   |--------------------------------------------------------------------------
   */
    'auth' => 'admin',

    /*
   |--------------------------------------------------------------------------
   | 路由配置
   |--------------------------------------------------------------------------
   */
    'route' => [
        'prefix' => 'api',

        'middlewares' => [
            \XditnModule\Middleware\AuthMiddleware::class,
            \XditnModule\Middleware\JsonResponseMiddleware::class,
        ],

        // API 版本控制

        // 默认 API 版本
        'version' => env('XDITN_API_VERSION', 'v1'),

        // 支持的 API 版本
        'supported_versions' => ['v1', 'v2'],

        // 版本 Header 名称（用于从请求头获取版本）
        'version_header' => 'X-API-Version',
    ],

    /*
   |--------------------------------------------------------------------------
   | 前端 Vue 视图文件夹路径
   |
   | 如果不设置，将不会生成相关的 Vue 文件
   |--------------------------------------------------------------------------
   */
    'views_path' => base_path('web'.DIRECTORY_SEPARATOR.'src'.DIRECTORY_SEPARATOR.'views'.DIRECTORY_SEPARATOR),

    /*
   |--------------------------------------------------------------------------
   | 开启系统接口日志分析
   |
   | 接口日志依赖 Redis，提高性能
   |--------------------------------------------------------------------------
   */
    'system_api_log' => env('XDITN_SYSTEM_API_LOG', false),

    /*
   |--------------------------------------------------------------------------
   | 图片处理
   |
   | 默认使用 GD
   |--------------------------------------------------------------------------
   */
    'image' => [
        'driver' => env('XDITN_IMAGE_DRIVER', 'gd'),

        'options' => [

        ],

        /**
         * 默认读取磁盘.
         */
        'read_from' => env('XDITN_IMAGE_READ_FROM', 'uploads'),
    ],

    /*
    |--------------------------------------------------------------------------
    | 后台缓存统一管理
    |
    | 配置后台缓存前缀，便于清理后台管理的缓存
    |--------------------------------------------------------------------------
    */
    'admin_cache_key' => env('XDITN_ADMIN_CACHE_KEY', 'admin_dashboard_'),

    /*
    |--------------------------------------------------------------------------
    | 模型相关配置
    |
    | 配置模型的配置
    |--------------------------------------------------------------------------
    */
    'model' => [
        // created_at & updated_at format
        'date_format' => 'Y-m-d H:i:s',
    ],

    /*
    |--------------------------------------------------------------------------
    | Excel 配置
    |--------------------------------------------------------------------------
    */
    'excel' => [
        /**
         * 导出路径, 相对于 storage 目录得相对路径.
         */
        'export_path' => 'excel/export',
    ],

    /*
    |--------------------------------------------------------------------------
    | 金额配置
    |--------------------------------------------------------------------------
    |
    | 配置金额转换比例（系统单位转分）
    | 例如：USD 转分 = 100，CNY 转分 = 100
    |
    |--------------------------------------------------------------------------
    */
    'amount' => [
        /**
         * 金额转换比例（系统单位转分）
         * 例如：100 表示 1 USD = 100 分.
         */
        'conversion_rate' => env('XDITN_AMOUNT_CONVERSION_RATE', 100),

        /**
         * 默认货币单位.
         */
        'default_currency' => env('XDITN_AMOUNT_DEFAULT_CURRENCY', 'USD'),
    ],

    /*
    |--------------------------------------------------------------------------
    | API 速率限制配置
    |--------------------------------------------------------------------------
    */
    'rate_limit' => [
        // 是否启用速率限制
        'enabled' => env('XDITN_RATE_LIMIT_ENABLED', true),

        // 最大请求次数（每时间窗口）
        'max_attempts' => env('XDITN_RATE_LIMIT_MAX_ATTEMPTS', 60),

        // 时间窗口（分钟）
        'decay_minutes' => env('XDITN_RATE_LIMIT_DECAY_MINUTES', 1),
    ],

    /*
    |--------------------------------------------------------------------------
    | 响应压缩配置
    |--------------------------------------------------------------------------
    */
    'compression' => [
        // 是否启用响应压缩
        'enabled' => env('XDITN_COMPRESSION_ENABLED', false),

        // 最小压缩大小（字节）
        'min_size' => env('XDITN_COMPRESSION_MIN_SIZE', 1024),

        // 压缩级别 1-9（级别越高压缩率越高但耗时更长）
        'level' => env('XDITN_COMPRESSION_LEVEL', 6),
    ],

    /*
    |--------------------------------------------------------------------------
    | 请求追踪配置
    |--------------------------------------------------------------------------
    */
    'tracing' => [
        // 是否启用请求追踪
        'enabled' => env('XDITN_TRACING_ENABLED', true),

        // 追踪 ID 头名称
        'header' => env('XDITN_TRACING_HEADER', 'X-Trace-Id'),

        // 是否记录请求日志
        'log_requests' => env('XDITN_TRACING_LOG_REQUESTS', false),
    ],

    /*
    |--------------------------------------------------------------------------
    | 软删除数据清理配置
    |--------------------------------------------------------------------------
    */
    'soft_delete' => [
        // 是否启用自动清理
        'auto_purge' => env('XDITN_SOFT_DELETE_AUTO_PURGE', true),

        // 清理多少天前的软删除数据
        'purge_after_days' => env('XDITN_SOFT_DELETE_PURGE_DAYS', 30),
    ],

    /*
    |--------------------------------------------------------------------------
    | 数据库查询日志配置
    |--------------------------------------------------------------------------
    */
    'query_log' => [
        // 是否启用查询日志
        'enabled' => env('XDITN_QUERY_LOG_ENABLED', false),

        // 慢查询阈值（毫秒）
        'slow_threshold' => env('XDITN_QUERY_LOG_SLOW_THRESHOLD', 1000),

        // 日志通道
        'log_channel' => env('XDITN_QUERY_LOG_CHANNEL', 'query'),

        // 是否记录所有查询（谨慎使用，会产生大量日志）
        'log_all' => env('XDITN_QUERY_LOG_ALL', false),
    ],
];
